const DefaultMinValue = 5;
const DefaultMaxValue = 50;

function produceNewData(oldData, min, max) {
    const len = Math.floor(Math.random() * (max - min)) + min;
    const data = [];
    for (let i = 0; i < len; i += 1) {
        if (Math.round(Math.random()) === 1 && oldData[i]) {
            data.push(oldData[i]);
        } else {
            data.push({
                x: Math.floor(Math.random() * 100)
            });
        }
    }
    return data;
}

export default class Bar {
    /*
    @prop min = DefaultMinValue;
    @prop max = DefaultMaxValue;
    @prop label;
    @prop title;
    */

    constructor() {
        this.counter = 0;
        this.itemClassName = 'item';
        this.data = [];
    }

    static get observedAttributes() {
        return ['min', 'max'];
    }

    attributeChangedCallback() {
        this.data = produceNewData(this.data, this.min, this.max);
    }

    handleClick() {
        this.counter += 1;
        const newData = produceNewData(this.data, this.min, this.max);
        this.data = newData;
        console.log('clicked');
    }



    // IMPORTANT: after this line, all code is generated by the build process
    // this is a generated method based on the template
    render({h,i,m,v}) {
        const iter1 = (item) => {
            return h('li', { attrs: { class: this.itemClassName } }, ['Value of X = ', item.x]);
        };
        const m0 = m(0, () => this.handleClick(...arguments));
        return h('div', { attrs: { tabindex: 2 } }, [
            this.title ? h('h1', {}, [this.title]) : '',
            h('ul', {}, [
                h('li', { attrs: { class: 'first' } }, ['header']),
                ...i(this.data, iter1),
                h('li', { attrs: { class: 'last' } }, ['footer']),
            ]),
            h('button', { on: { click: m0 } }, [this.label || '']),
        ]);
    }
}

Bar.$p$ = {
    min: DefaultMinValue,
    max: function () { return DefaultMaxValue },
    title: null,
    label: null,
};
Bar.$m$ = [];
Bar.$t$ = ['title', 'itemClassName', 'data', 'label', 'handleClick'];

// Example of usage:
// <Bar min="5" max="10" label="re-shuffle" />
